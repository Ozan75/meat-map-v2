<!DOCTYPE html>
  <html>
    <head>
      <link rel="stylesheet" href="css/styles.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    </head>
    <body>
      <div id="meat-map"></div>

      <script type="text/javascript">

      // VARS

      var lastPos = JSON.parse(localStorage.getItem('currentPos')); // passing over last known Geo location from Local Storage as an ARRAY
      var mapStyle = null;

      // SAVING JSON STYLE FILE INTO VAR
      $.getJSON("http://localhost:8888/meat-map-v2/mapstyle.json", function(json) {
        mapStyle = json;
      });

        // Creating Map
        function initMap() {

          var map = new google.maps.Map(document.getElementById('meat-map'), {
            center: lastPos,
            zoom: 16,
            styles: mapStyle // Styles a map in night mode.

          });
          var infoWindow = new google.maps.InfoWindow({map: map});

          // Try HTML5 geolocation.
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };

            // Saving current geo location to Local Storage as a STRING
            localStorage.setItem('currentPos', JSON.stringify(pos));
            var pos = JSON.parse(localStorage.getItem('currentPos'));

            // Centering Map and positionig infoWindow
            infoWindow.setPosition(pos);
            infoWindow.setContent('New location found.');
            map.setCenter(pos);

            }, function() {
              // Information send to HandleLocationError Function - Browser supports Geolocation
              handleLocationError(true, infoWindow, map.getCenter());
            });
          } else {
            // Information send to HandleLocationError Function - Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
          }
        }

        function handleLocationError(browserHasGeolocation, infoWindow, lastPos, pos) {
          infoWindow.setPosition(browserHasGeolocation ? lastPos : pos);
          infoWindow.setContent(browserHasGeolocation ? 'Last position saved' : 'Error: Your browser doesn\'t support geolocation.');
        }
      </script>

      <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApvU9qq_94kSmbOrB0qgV8c6W__CAiKV4&callback=initMap">
      </script>
    </body>
  </html>
